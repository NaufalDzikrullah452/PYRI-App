<>
  <effect
    meta={{
      tabActive: "home",
      tabActivePyri: "history",
      tabActiveExplore: "categories",
      tabLink: "",
      page_recommend: 0,
      new_releases_length: 0,
      pages: [],
      tabGenres: true,
      tabRead: true,
      tabProfile: true,
      user: [],
      user_premium: [],
      book: [],
      popularBook: [],
      recommendBook: [],
      newReleaseBook: [],
      freeBook: [],
      free_book_amount: 0,
      interest: [],
      history: [],
      bookmarks: [],
      get_rating_popular: [],
      loading: true,
      loadingInterest: true,
      showMoreNewReleases: false,

      async showMore(key) {
        if (key === "NewReleases") {
          runInAction(() => {
            this.showMoreNewReleases = true;
          });
          setTimeout(() => {
            runInAction(() => {
              this.new_releases_length =
                this.newReleaseBook.length > this.new_releases_length + 5
                  ? this.new_releases_length + 5
                  : this.newReleaseBook.length;
            });
            this.showMoreNewReleases = false;
          }, 1000);
        }
      },

      async changeRecommend(key) {
        if (key === "next") {
          let length =
            this.recommendBook.length > 3 ? 3 : this.recommendBook.length;
          runInAction(() => {
            this.page_recommend =
              this.page_recommend < length - 1
                ? this.page_recommend + 1
                : this.page_recommend;
          });
          let fade = document.getElementById(
            "recommend-" + this.page_recommend
          );
          fade.style.opacity = "0.5";
          setTimeout(() => {
            fade.style.opacity = "1";
          }, 200);
        } else if (key === "prev") {
          runInAction(() => {
            this.page_recommend =
              this.page_recommend > 0
                ? this.page_recommend - 1
                : this.page_recommend;
          });
          let fade = document.getElementById(
            "recommend-" + this.page_recommend
          );
          fade.style.opacity = "0.5";
          setTimeout(() => {
            fade.style.opacity = "1";
          }, 100);
        } // console.log(this.page_recommend);
      },

      async readHistoryFree(book_id) {
        api("/api/free-books", {
          freeBook: {
            freeBook_user_id: window.user.user.user_id,
          },
          e: "ReadByUserId",
        }).then((res) => {
          // console.log(res)
          if (res.freeBook !== null) {
            runInAction(() => {
              this.freeBook = res.freeBook;
              this.free_book_amount = res.freeBook.freeBook_amount;
            });
            let regis_month1 = dateAdd(
              new Date(this.freeBook.freeBook_date_registered),
              {
                months: 1,
              }
            );
            let regis_month = this.freeBook.freeBook_date_registered;
            let compare_regis =
              compareAsc(new Date(), new Date(regis_month1)) !== -1; // console.log(new Date() + " <br> "+ new Date(regis_month1))
            // console.log(compareAsc(new Date(), new Date(regis_month1)))

            if (compare_regis) {
              // window.mobileApp.app.sheet.open(".sheet-free-books")
              this.toast("Monthly free expired.", "center", 2000);
            } else {
              api("/api/history-book", {
                viewBook: {
                  freeBook_date_registered: regis_month,
                  freeBook_date_exp: regis_month1,
                  viewBook_user_id: window.user.user.user_id,
                },
                e: "ReadHistoryUserFreeBook",
              }).then((res) => {
                // console.log(res);
                let res_viewBook = res.viewBook;
                var inHistory = false;
                res_viewBook.map((value, index) => {
                  if (index < 3 && value.books.book_id === parseInt(book_id)) {
                    inHistory = true;
                  }
                });

                if (!inHistory && this.free_book_amount !== 0) {
                  runInAction(() => {
                    this.free_book_amount -= 1;
                  });
                  api("/api/free-books", {
                    freeBook: {
                      freeBook_user_id: window.user.user.user_id,
                      freeBook_amount: this.free_book_amount,
                      freeBook_date_updated: new Date(),
                    },
                    e: "UpdateByUserId",
                  });
                  window.mobileApp.app.dialog.preloader(
                    "Free books used (" + (3 - this.free_book_amount) + "/3)"
                  );
                  setTimeout(() => {
                    window.mobileApp.app.dialog.close();
                  }, 1500);
                  navigate("/m/read-book-page/" + book_id + "/");
                } else if (inHistory) {
                  window.mobileApp.app.dialog.preloader();
                  setTimeout(() => {
                    window.mobileApp.app.dialog.close();
                  }, 1500);
                  navigate("/m/read-book-page/" + book_id + "/");
                } else {
                  window.mobileApp.app.dialog.confirm(
                    "Free books used (" +
                      (3 - this.free_book_amount) +
                      "/3), get premium to read all books for free. Redirect to purchase page?",
                    "Free books is out.",
                    () => {
                      navigate("/m/premium-page");
                    }
                  );
                }
              });
            }
          } else {
            window.mobileApp.app.dialog.confirm(
              "Get premium to read all books for free. Redirect to purchase page?",
              "Go to Premium.",
              () => {
                navigate("/m/premium-page");
              }
            );
          }
        });
      },

      async onClickTabPyri(tab) {
        // console.log(tab);
        this.readHistory();
        this.readBookmarks();
        this.tabActivePyri = tab;
      },

      async onClickTabExplore(tab) {
        if (tab === "categories") {
          this.actionCategory();
        } else if (tab === "genres" && tab !== this.tabActiveExplore) {
          this.actionGenre();
        }

        this.tabActiveExplore = tab;
      },

      async onClickTab(tab) {
        // console.log(tab);
        if (window.user.role === "guest" && tab === "profile") {
          window.mobileApp.app.dialog.confirm(
            "direct to login page?",
            "You are not logged in!",
            () => {
              navigate("/m/login");
            }
          );
        } else if (tab === "profile" && this.tabProfile) {
          this.tabActive = tab;
          this.tabProfile = false;
          this.loadingInterest = true; // window.mobileApp.app.dialog.preloader();

          api("/api/interests", {
            e: "show",
            user_id: window.user.user.user_id,
          }).then((res) => {
            // console.log(res.result)
            document.getElementById("kotak").className =
              "flex self-stretch items-start justify-start space-x-1.5"; // membuat div interest

            for (let index = 0; index < res.result.length; index++) {
              let mainDiv = document.createElement("div");
              mainDiv.className =
                "flex flex-1 items-center justify-center px-2.5 py-0.5 bg-gray-200 rounded";
              document.getElementById("kotak").appendChild(mainDiv);
              let textDiv = document.createElement("div");
              textDiv.className =
                "text-xs font-bold leading-none text-gray-700";
              textDiv.innerHTML = res.result[index].tags.tag_name;
              mainDiv.appendChild(textDiv);
            }

            runInAction(() => {
              this.loadingInterest = false;
            }); // window.mobileApp.app.dialog.close();
          }); // console.log(tag.result)
        } else if (tab !== "profile" && tab !== this.tabActive) {
          if (tab === "pyriList") {
            this.tabActivePyri = "history";
            this.readHistory();
          } else if (tab === "explore" && tab !== this.tabActive) {
            this.tabActiveExplore = "categories";
            this.onClickTabExplore(this.tabActiveExplore);
          } else if (tab === "home") {
            this.readHomeTabs();
            runInAction(() => {
              this.page_recommend = 0;
            });
          }

          this.tabProfile = true;
          this.tabActive = tab;
        }
      },

      async logout() {
        window.mobileApp.app.dialog.confirm(null, "Logout of PyriApp?", () => {
          window.mobileApp.app.dialog.preloader();
          setTimeout(function () {
            api("/api/api-users", {
              users: "Logout",
              e: "Logout",
            }).then((res) => {
              // console.log(res);
              window.user = {
                role: "guest",
                roleAdmin: window.user.roleAdmin || "",
                admin: window.user.admin || "",
              };
              window.mobileApp.app.dialog.close();
              navigate("/m/");
            });
          }, 1000);
        });
      },

      async readHistory() {
        var page_chapter = ""; //read history read

        if (window.user.role !== "guest") {
          await api("/api/history-book", {
            viewBook: {
              viewBook_user_id: window.user.user.user_id,
            },
            e: "ReadByUserId",
          }).then((res) => {
            // console.log(res);
            if (res !== null && res.viewBook.length !== 0) {
              runInAction(() => {
                this.pages = [];
                this.book = [];
                this.history = res.viewBook;
                this.history.map((value, index) => {
                  runInAction(() => {
                    this.book.push(value.books);
                  });
                }); // console.log(this.book[0])

                if (this.book[0].page.length !== 0) {
                  this.book.map((value, index) => {
                    runInAction(() => {
                      page_chapter = this.book[index].page;
                    });
                    page_chapter.sort(function (a, b) {
                      var aNum = parseInt(a.page_page);
                      var bNum = parseInt(b.page_page);
                      return aNum - bNum;
                    });
                    page_chapter.sort(function (a, b) {
                      var aNum = parseInt(a.page_chapter_id);
                      var bNum = parseInt(b.page_chapter_id);
                      return aNum - bNum;
                    });
                    page_chapter.map((value, idx) => {
                      if (
                        value.page_id === this.history[index].viewBook_page_id
                      ) {
                        runInAction(() => {
                          this.pages.push(idx + 1);
                        });
                      }
                    });
                  });
                } // console.log(this.history);
              });
            }
          });
        }
      },

      async readBookmarks() {
        if (window.user.role !== "guest") {
          await api("/api/bookmarks", {
            bookmark: {
              bookmark_user_id: window.user.user.user_id,
            },
            e: "ReadByUserId",
          }).then((res) => {
            // console.log(res)
            if (res !== null && res.bookmark.length !== 0) {
              runInAction(() => {
                this.bookmarks = res.bookmark;
              });
            } else {
              runInAction(() => {
                this.bookmarks = [];
              });
            }
          });
        }
      },

      async toast(text, position, time) {
        var toastCenter = window.mobileApp.app.toast.create({
          text: text,
          position: position,
          closeTimeout: time,
        }); // Open it

        toastCenter.open();
      },

      async deleteBookmark(bookmark_id) {
        if (window.user.role !== "guest") {
          window.mobileApp.app.dialog.confirm(
            "Remove book from read later.",
            "Confirm delete?",
            () => {
              api("/api/bookmarks", {
                bookmark: {
                  bookmark_id: bookmark_id,
                },
                e: "Delete",
              }).then((res) => {
                // console.log(res)
                if (res !== null) {
                  runInAction(() => {
                    this.readBookmarks();
                    this.toast("Remove success", "center", 2000);
                  });
                } else {
                  this.toast("Database error", "center", 2000);
                }
              });
            }
          );
        }
      },

      async actionCategory() {
        let categories;
        await api("/api/categories", {
          category: " ",
          e: "ReadAll",
        }).then((res) => {
          categories = res.category; // console.log(categories);
        });
        document.getElementById("categories").innerHTML = "";
        document.getElementById("categories").className =
          "flex flex-1 self-stretch flex-col space-y-3 items-center justify-start px-6 css-1wv53zm tab";

        for (let ind = 0; ind < Math.ceil(categories.length / 2); ind++) {
          let a = document.createElement("div");
          a.className =
            "flex self-stretch space-x-4 items-center justify-center";
          a.id = "rc" + ind;
          document.getElementById("categories").appendChild(a);
        }

        for (let ind = 0; ind < categories.length; ind++) {
          let a = document.createElement("div");
          a.className =
            "flex self-stretch flex-col items-start justify-start rounded-lg";
          a.style.width = "173.50px";
          a.style.maxWidth = "173.50px";
          a.style.height = "96px";
          a.style.maxHeight = "96px";
          a.style.borderRadius = "14px";
          a.style.backgroundImage = `url(../upload/${categories[ind].category_pictures})`;
          a.style.backgroundSize = "100% 100%";
          a.style.backgroundRepeat = "no-repeat";

          a.onclick = () => {
            navigate("/m/explore/categories/" + categories[ind].category_id);
          };

          let b = document.createElement("div");
          b.className =
            "flex flex-1 self-stretch flex-col items-center justify-center px-4 bg-black bg-opacity-60 css-j3shp6";
          b.style.borderRadius = "14px";
          let c = document.createElement("div");
          c.className =
            "text-base font-bold leading-normal text-center text-white";
          c.innerText = categories[ind].category_name;
          b.appendChild(c);
          a.appendChild(b);
          document.getElementById("rc" + Math.floor(ind / 2)).appendChild(a);
        }
      },

      async actionGenre() {
        let genres;
        await api("/api/tags", {
          tags: " ",
          e: "ReadAll",
        }).then((res) => {
          genres = res.tags; // console.log(genres);
        });
        document.getElementById("genres").innerHTML = "";
        document.getElementById("genres").className =
          "flex flex-1 self-stretch flex-col space-y-3 items-center justify-start px-6 mt-4 css-10rbni4 tab";

        for (let ind = 0; ind < Math.ceil(genres.length / 3); ind++) {
          let a = document.createElement("div");
          a.className = "flex self-stretch space-x-4 items-start justify-start";
          a.id = "rc" + ind;
          document.getElementById("genres").appendChild(a);
        }

        for (let ind = 0; ind < genres.length; ind++) {
          let a = document.createElement("div");
          a.className =
            "flex flex-col space-y-2.5 items-center justify-start px-6 py-4 bg-gray-50 shadow rounded-lg";

          a.onclick = () => {
            navigate("/m/explore/genre/" + genres[ind].tag_id);
          };

          let bi = document.createElement("img");
          bi.className =
            "flex items-center justify-center bg-white rounded-full css-m6pyji";
          bi.setAttribute("src", "/upload/" + genres[ind].tag_picture);
          bi.style.width = "64px";
          bi.style.maxWidth = "64px";
          bi.style.height = "64px";
          bi.style.maxHeight = "64px";
          let c = document.createElement("div");
          c.className = "text-sm font-bold leading-tight";
          c.innerText = genres[ind].tag_name;
          a.appendChild(bi);
          a.appendChild(c);
          document.getElementById("rc" + Math.floor(ind / 3)).appendChild(a);
        }
      },

      async readRecommend() {
        //reset
        let recommendBook_temp = []; // based on the author book from user highest rating

        api("/api/rating", {
          rating: {
            rating_user_id: window.user.user.user_id,
          },
          e: "ReadByUserId",
        }).then((res) => {
          // console.log(res.rating)
          if (res.rating.length !== 0) {
            let rating = res.rating;
            rating.sort(function (a, b) {
              var aNum = a.rating_point;
              var bNum = b.rating_point;
              return bNum - aNum;
            }); // console.log(rating[0])

            let author_id = null;

            if (rating[0].rating_point >= 4) {
              if (
                rating[0].books.authors_authorsTobooks_book_author_one_id !==
                null
              ) {
                author_id =
                  rating[0].books.authors_authorsTobooks_book_author_one_id
                    .author_id;
              } else if (
                rating[0].books.authors_authorsTobooks_book_author_two_id !==
                null
              ) {
                author_id =
                  rating[0].books.authors_authorsTobooks_book_author_two_id
                    .author_id;
              } else if (
                rating[0].books.authors_authorsTobooks_book_author_three_id !==
                null
              ) {
                author_id =
                  rating[0].books.authors_authorsTobooks_book_author_three_id
                    .author_id;
              }
            } // console.log(author_id)

            if (author_id !== null) {
              api("/api/books", {
                book: {
                  book_author_id: author_id,
                },
                e: "ReadByAuthorId",
              }).then((res) => {
                // console.log(res)
                let data_recommendBook = res.book;
                data_recommendBook.map((a, i) => {
                  var sum = 0;
                  var avg = 0;
                  a.rating.map((b) => {
                    sum += b.rating_point;
                  });

                  if (a.rating.length !== 0) {
                    avg = parseFloat(sum / a.rating.length);
                  }

                  this.get_rating_popular.push(avg);
                  data_recommendBook[i]["rating_avg"] = avg;
                });
                data_recommendBook.sort(function (a, b) {
                  var aNum = a.rating_avg;
                  var bNum = b.rating_avg;
                  return bNum - aNum;
                });

                if (data_recommendBook.length !== 0) {
                  runInAction(() => {
                    data_recommendBook[0].recommend = "rating";
                    recommendBook_temp.push(data_recommendBook[0]);
                    runInAction(() => {
                      this.recommendBook = recommendBook_temp;
                    }); // console.log(this.recommendBook);
                  });
                } // console.log(recommendBook[0])
              });
            }
          }
        }); // based on the tag of last history read

        if (this.history.length !== 0) {
          let interest_user = [];
          api("/api/interests", {
            e: "show",
            user_id: window.user.user.user_id,
          }).then((res) => {
            // console.log(res)
            if (res.result.length !== 0) {
              interest_user = res.result;
              var tagsAndInterest = [];
              interest_user.map((e, i) => {
                // console.log(e.tags.tag_name);
                if (this.history.length !== 0) {
                  if (
                    this.history[0].books.tags_books_book_genre_one_idTotags
                      .tag_id === e.tags.tag_id
                  ) {
                    // console.log(e.tags.tag_name);
                    var filter_popular_book = this.popularBook.filter(function (
                      el
                    ) {
                      return (
                        el.tags_books_book_genre_one_idTotags.tag_id ===
                          e.tags.tag_id && el.rating_avg !== 0
                      );
                    });

                    if (filter_popular_book.length !== 0) {
                      runInAction(() => {
                        filter_popular_book[0].recommend = "history x interest";
                        recommendBook_temp.push(filter_popular_book[0]);
                        runInAction(() => {
                          this.recommendBook = recommendBook_temp;
                        }); // console.log(this.recommendBook);
                      });
                    }
                  }
                }
              }); // console.log(tagsAndInterest);
            }
          }); //based history read more equal than 50% of total pages

          api("/api/books", {
            book: {
              viewBook: {
                viewBook_user_id: window.user.user.user_id,
              },
            },
            e: "ReadHistoryByUserId",
          }).then((res) => {
            // console.log(res)
            if (res.book.length !== 0) {
              var filter_history = res.book.filter(function (el) {
                var half_pages = el.page.length / 2;
                return el.viewBook.length >= half_pages;
              }); // console.log(filter_history[0])

              let tag_id = null;

              if (filter_history[0] !== undefined) {
                if (
                  filter_history[0].tags_books_book_genre_one_idTotags !== null
                ) {
                  tag_id =
                    filter_history[0].tags_books_book_genre_one_idTotags.tag_id;
                } else if (
                  filter_history[0].tags_books_book_genre_two_idTotags !== null
                ) {
                  tag_id =
                    filter_history[0].tags_books_book_genre_two_idTotags.tag_id;
                } else if (
                  filter_history[0].tags_books_book_genre_three_idTotags !==
                  null
                ) {
                  tag_id =
                    filter_history[0].tags_books_book_genre_three_idTotags
                      .tag_id;
                }
              } // console.log(tag_id);

              if (tag_id !== null) {
                api("/api/books", {
                  book: {
                    book_tag_id: tag_id,
                  },
                  e: "ReadByTagId",
                }).then((res) => {
                  // console.log(res)
                  let data_recommendBook = res.book;
                  data_recommendBook.map((a, i) => {
                    var sum = 0;
                    var avg = 0;
                    a.rating.map((b) => {
                      sum += b.rating_point;
                    });

                    if (a.rating.length !== 0) {
                      avg = parseFloat(sum / a.rating.length);
                    }

                    this.get_rating_popular.push(avg);
                    data_recommendBook[i]["rating_avg"] = avg;
                  });
                  data_recommendBook.sort(function (a, b) {
                    var aNum = a.rating_avg;
                    var bNum = b.rating_avg;
                    return bNum - aNum;
                  });

                  if (data_recommendBook.length !== 0) {
                    runInAction(() => {
                      data_recommendBook[0].recommend =
                        "history more than 3 pages";
                      recommendBook_temp.push(data_recommendBook[0]); // console.log(this.recommendBook);
                      // distinct same book

                      let temp_id = [];
                      let temp_data = [];
                      recommendBook_temp.map((v, i) => {
                        // console.log(v);
                        if (!temp_id.includes(v.book_id)) {
                          temp_data.push(v);
                          temp_id.push(v.book_id);
                        }
                      });
                      recommendBook_temp = temp_data;
                      runInAction(() => {
                        this.recommendBook = recommendBook_temp;
                      });
                    });
                  } // console.log(recommendBook[0])
                });
              }
            }
          });
        } // based on interest user

        let recommend_interest = [];
        api("/api/interests", {
          e: "show",
          user_id: window.user.user.user_id,
        }).then((res) => {
          // console.log(res)
          api("/api/books", {
            book: {
              book_genre_one_id: res.result[0] ? res.result[0].tag_id : 0,
              book_genre_two_id: res.result[1] ? res.result[1].tag_id : 0,
              book_genre_three_id: res.result[2] ? res.result[2].tag_id : 0,
            },
            e: "ReadByGenreIdRecommend",
          }).then((res) => {
            // console.log(res.book)
            if (res.book.length !== 0) {
              recommend_interest = res.book;
              recommend_interest.map((a, i) => {
                var sum = 0;
                var avg = 0;
                a.rating.map((b) => {
                  sum += b.rating_point;
                });

                if (a.rating.length !== 0) {
                  avg = parseFloat(sum / a.rating.length);
                }

                this.get_rating_popular.push(avg);
                recommend_interest[i]["rating_avg"] = avg;
                recommend_interest[i]["recommend"] = "Interest user-" + i;
              });
              recommend_interest.sort(function (a, b) {
                var aNum = a.rating_avg;
                var bNum = b.rating_avg;
                return bNum - aNum;
              }); // console.log(recommend_interest)

              if (recommend_interest.length !== 0) {
                // console.log(this.recommendBook);
                recommend_interest
                  .slice(
                    0,
                    recommend_interest.length > 3
                      ? 3
                      : recommend_interest.length
                  )
                  .map((a, b) => {
                    runInAction(() => {
                      recommendBook_temp.push(a);
                    });
                  }); // distinct same book

                let temp_id = [];
                let temp_data = [];
                recommendBook_temp.map((v, i) => {
                  // console.log(v);
                  if (!temp_id.includes(v.book_id)) {
                    temp_data.push(v);
                    temp_id.push(v.book_id);
                  }
                });
                recommendBook_temp = temp_data; // console.log(this.recommendBook);

                runInAction(() => {
                  this.recommendBook = recommendBook_temp;
                });
              }
            }
          });
        });
      },

      async readHomeTabs() {
        // read popular book
        var popularBook = [];
        await api("/api/books", {
          book: "",
          e: "ReadAllPublished",
        }).then((res) => {
          // console.log(res);
          if (res !== null && res.book.length != 0) {
            popularBook = res.book;
          }
        }); // read book

        var newReleaseBook = [];
        await api("/api/books", {
          book: "",
          e: "ReadAllNewRelease",
        }).then((res) => {
          // console.log(res)
          if (res !== null && res.book.length != 0) {
            newReleaseBook = res.book;
          }
        });
        runInAction(() => {
          this.user = window.user.user || [];
          this.newReleaseBook = newReleaseBook;
          this.new_releases_length =
            newReleaseBook.length > 5 ? 5 : newReleaseBook.length;
          popularBook.map((a, i) => {
            var sum = 0;
            var avg = 0;
            a.rating.map((b) => {
              sum += b.rating_point;
            });

            if (a.rating.length !== 0) {
              avg = parseFloat(sum / a.rating.length);
            }

            this.get_rating_popular.push(avg);
            popularBook[i]["rating_avg"] = avg;
          });
          var data = [];
          popularBook.map((a, i) => {
            if (a.rating_avg >= 4) {
              data.push(a);
            }
          });
          popularBook = data;
          popularBook.sort(function (a, b) {
            var aNum = a.viewBook.length;
            var bNum = b.viewBook.length;
            return bNum - aNum;
          });
          let temp_popularbook = [];
          var date = new Date();
          var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
          var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0); // console.log(dateFormat(firstDay, "dd/MM/yyyy"))
          // console.log(dateFormat(lastDay, "dd/MM/yyyy"))

          popularBook.map((a, i) => {
            var views_month = 0; // console.log(a)

            a.viewBook.map((b) => {
              var time = new Date(b.viewBook_access_date).getTime();

              if (time >= firstDay.getTime() && time <= lastDay.getTime()) {
                views_month += 1;
              }
            });
            popularBook[i]["views_month"] = views_month;

            if (views_month !== 0) {
              temp_popularbook.push(a);
            }
          });
          temp_popularbook.sort(function (a, b) {
            if (a.views_month !== undefined && b.views_month !== undefined) {
              var aNum = a.views_month;
              var bNum = b.views_month;
              return bNum - aNum;
            }
          }); // console.log(temp_popularbook);

          let temp_id = [];
          let temp_data = [];

          if (temp_popularbook.length !== 0) {
            temp_popularbook.map((v, i) => {
              // console.log(v);
              if (!temp_id.includes(v.book_id)) {
                temp_data.push(v);
                temp_id.push(v.book_id);
              }
            });
          }

          popularBook.map((v, i) => {
            // console.log(v);
            if (!temp_id.includes(v.book_id)) {
              temp_data.push(v);
              temp_id.push(v.book_id);
            }
          });
          temp_popularbook = temp_data; // console.log(temp_popularbook);
          // console.log(popularBook);
          // popularBook.sort(function (a, b) {
          //   if(a.rating_avg !== undefined && b.rating_avg !== undefined){
          //     var aNum = a.rating_avg;
          //     var bNum = b.rating_avg;
          //     return bNum - aNum;
          //   }
          // });

          this.popularBook = temp_popularbook; // console.log(popularBook)

          setTimeout(() => {
            runInAction(() => {
              this.loading = false;
            });
          }, 3000);
        });

        if (window.user.role !== "guest") {
          api("/api/api-users", {
            users: {
              user_id: window.user.user.user_id,
            },
            e: "ReadUserSubscriptionById",
          }).then((res) => {
            // console.log(res);
            if (res.users !== null) {
              runInAction(() => {
                this.user_premium = res.users; //         console.log(dateFormat(this.user_premium.expired_date, "dd MM yyyy"))
                //         console.log(dateFormat(new Date(), "dd MM yyyy"))
                //         console.log(dateFormat(this.user_premium.expired_date, "dd MM yyyy") >
                // dateFormat(new Date(), "dd MM yyyy"))
              });
            } // console.log(this.user_premium.length == 0)
          });
          api("/api/free-books", {
            freeBook: {
              freeBook_user_id: window.user.user.user_id,
            },
            e: "ReadByUserId",
          }).then((res) => {
            // console.log(res);
            if (res.freeBook !== null) {
              runInAction(() => {
                this.freeBook = res.freeBook;
                this.free_book_amount = res.freeBook.freeBook_amount;
              });
            }
          });
          this.readRecommend();
        }
      },
    }}
    run={async ({}) => {
      meta.readHistory();
      meta.readBookmarks();
      meta.readHomeTabs();
    }}
  />
  <div
    class={`flex items-end justify-center bg-white`}
    style={"margin-bottom: 50px;"}
  >
    <div
      class={`flex flex-1 self-stretch flex-col items-center justify-start bg-gradient-to-b from-white to-white w-full`}
    >
      <div class="flex self-stretch flex-col items-start justify-start bg-orange-100">
        <div
          class={`flex self-stretch space-x-2.5 items-center justify-center px-6 py-4 bg-white shadow`}
        >
          <img
            src="/fimgs/4951_94071.x1.svg"
            style="width: 24px; min-width: 24px; max-width: 24px; height: 24px; min-height: 24px; max-height: 24px;"
          />
          <div class="flex items-start justify-start">
            <div class="text-xl font-bold leading-loose">PYRI</div>
          </div>
        </div>
        <div
          class={`flex self-stretch flex-col space-y-2 items-start justify-start`}
        >
          {window.user.role === "guest" &&
            meta.tabActive === "home" &&
            !meta.loading && (
              <div
                class={`flex self-stretch space-x-2 items-center justify-start p-4 bg-orange-50 w-full`}
              >
                <img
                  src="/fimgs/1198_41628.x1.svg"
                  class="flex flex-col items-start justify-start"
                  style="width: 108.21px; min-width: 108.21px; max-width: 108.21px; height: 100px; min-height: 100px; max-height: 100px;"
                />
                <div class="flex flex-1 self-stretch flex-col space-y-4 items-start justify-center">
                  <div class="flex self-stretch items-start justify-start">
                    <div class="text-xl font-bold leading-loose">
                      Login dulu kuy!
                    </div>
                  </div>
                  <div class="flex self-stretch flex-col items-start justify-center">
                    <button
                      class={`flex items-center justify-center px-4 py-1 bg-amber-500 rounded`}
                      style={`width: 61px; min-width: 61px; max-width: 61px; height: 26px; min-height: 26px; max-height: 26px;`}
                      onClick={(e) => {
                        navigate("/m/login");
                      }}
                    >
                      <div class="text-xs font-bold leading-none text-white">
                        Login
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            )}
          {window.user.role === "guest" &&
            meta.loading &&
            meta.tabActive === "home" && (
              <div
                class={`flex flex-col items-start justify-start p-5 w-full`}
                style={`height: 124px; min-height: 124px; max-height: 124px;`}
              >
                <loading-box class="shadow" />
              </div>
            )}
        </div>
      </div>
      <m-tabs
        class={`flex flex-1 self-stretch flex-col items-start justify-start w-full`}
        swipeable={true}
      >
        <m-tab
          class={`flex flex-1 self-stretch flex-col items-start justify-start`}
          id="home"
        >
          {window.user.role !== "guest" &&
            meta.tabActive === "home" &&
            meta.history.length !== 0 && (
              <div
                class={`flex self-stretch flex-col space-y-2.5 items-start justify-start p-6`}
              >
                {!meta.loading && (
                  <div
                    class={`flex self-stretch flex-col items-start justify-start p-4 shadow rounded`}
                    style={`background-image: url('/fimgs/bg-8d8ddb80570065b889eef54faf9c419dd251956e');background-size:100% 100%;background-repeat:no-repeat;`}
                    onClick={() => {
                      var birthday = new Date(window.user.user.user_birthday);
                      var ageDifMs = Date.now() - birthday.getTime();
                      var ageDate = new Date(ageDifMs);
                      var userAge = Math.abs(ageDate.getUTCFullYear() - 1970);

                      if (
                        meta.user_premium.length !== 0 &&
                        new Date(meta.user_premium.expired_date).getTime() >=
                          new Date().getTime()
                      ) {
                        if (
                          userAge < meta.history[0].books.book_age_restriction
                        ) {
                          meta.toast(
                            "You are not old enough to access this book. You must be at least " +
                              meta.history[0].books.book_age_restriction +
                              " years or older.",
                            "center",
                            2000
                          );
                        } else {
                          window.mobileApp.app.dialog.preloader("Loading...");
                          navigate(
                            "/m/read-book-page/" +
                              meta.history[0].books.book_id +
                              "/history"
                          );
                          setTimeout(() => {
                            window.mobileApp.app.dialog.close();
                          }, 2000);
                        }
                      } else {
                        if (
                          userAge < meta.history[0].books.book_age_restriction
                        ) {
                          meta.toast(
                            "You are not old enough to access this book. You must be at least " +
                              meta.history[0].books.book_age_restriction +
                              " years or older.",
                            "center",
                            2000
                          );
                        } else {
                          meta.readHistoryFree(meta.history[0].books.book_id);
                        }
                      }
                    }}
                  >
                    <div class="flex self-stretch space-x-2 items-center justify-start rounded">
                      <img
                        src={
                          meta.history[0].books.book_picture
                            ? "/upload/" + meta.history[0].books.book_picture
                            : "/fimgs/2640_1336744.x1.png"
                        }
                        onError={(e) => {
                          e.target.src = "";
                          e.target.src = "/fimgs/2640_1336744.x1.png";
                        }}
                        class={`flex items-start justify-start`}
                        style={`width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;`}
                      />
                      <div class="flex flex-1 space-x-0.5 items-center justify-center px-2">
                        <div class="flex flex-1 self-stretch flex-col space-y-0.5 items-start justify-start">
                          <div class="flex self-stretch items-start justify-start">
                            <div class="text-base font-bold leading-normal">
                              Continue Reading
                            </div>
                          </div>
                          <div class="flex self-stretch items-start justify-start">
                            <div class={`text-xs font-medium leading-none`}>
                              {meta.history[0].books.book_title || "Book title"}
                            </div>
                          </div>
                        </div>
                      </div>
                      <m-button
                        class={`flex items-center justify-center px-4 py-0.5 bg-amber-500 shadow rounded`}
                        style={`z-index: 1`}
                      >
                        <div class="text-xs font-bold leading-none text-white">
                          Continue
                        </div>
                      </m-button>
                    </div>
                  </div>
                )}
                {meta.loading && (
                  <div
                    class={`flex self-stretch flex-col items-start justify-start w-full`}
                    style={`height: 84px; min-height: 84px; max-height: 84px;`}
                  >
                    <loading-box class="shadow" />
                  </div>
                )}
              </div>
            )}
          {window.user.role !== "guest" &&
            meta.tabActive === "home" &&
            meta.recommendBook.length !== 0 && (
              <div
                class={`flex self-stretch flex-col space-y-2 items-start justify-start py-6 bg-orange-50`}
              >
                <div class="flex self-stretch space-x-2.5 items-end justify-start px-6">
                  <div class="flex flex-1 items-center justify-start">
                    <div class="text-xl font-bold leading-loose">
                      Recommend for you
                    </div>
                  </div>
                  <div class="flex self-stretch items-center justify-end">
                    <div class="text-base font-bold leading-normal text-right text-amber-500">
                      See more
                    </div>
                  </div>
                </div>
                <div
                  class={`flex self-stretch items-start justify-center px-6 over`}
                >
                  <div class="flex flex-1 flex-col space-y-2 items-center justify-end">
                    {!meta.loading && (
                      <div
                        class={`flex self-stretch flex-col space-y-2.5 items-center justify-start`}
                      >
                        <div
                          class={`flex items-start justify-start overflow-x-auto`}
                        >
                          {meta.recommendBook
                            .slice(
                              0,
                              meta.recommendBook.length > 4
                                ? 4
                                : meta.recommendBook.length
                            )
                            .map((value, i) => {
                              return (
                                <div
                                  id={"recommend-" + i}
                                  class={`flex flex-1 space-x-4 items-start justify-start p-4 bg-white shadow rounded w-full
        ${meta.page_recommend !== i ? "hidden" : ""}`}
                                  onClick={() => {
                                    navigate(
                                      "/m/detail-book-page/" +
                                        value.book_id +
                                        "/"
                                    );
                                  }}
                                  style={`background: #fff;
        opacity: 1;
        transition: opacity .3s ease-in-out;
  font-size: 18px;
  line-height: 200px;
  box-sizing: border-box;
  border: 1px solid #ccc;`}
                                >
                                  <div
                                    src="/fimgs/I1545_47723_1718_147206.x1.png"
                                    class={`flex items-start justify-start`}
                                  >
                                    <img
                                      src={
                                        value.book_picture
                                          ? "/upload/" + value.book_picture
                                          : "/fimgs/1718_224584.x1.png"
                                      }
                                      style={`width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat; border-radius: 4%`}
                                      onError={(e) => {
                                        e.target.onerror = null;
                                        e.target.src =
                                          "/fimgs/1718_224584.x1.png";
                                      }}
                                    />
                                  </div>
                                  <div
                                    class={`flex self-stretch flex-col items-start justify-center`}
                                    style={`justify-content: flex-start;
    padding-top: 10px;`}
                                  >
                                    <div class="flex self-stretch flex-col space-y-2 items-start justify-start">
                                      <div class="flex self-stretch flex-col items-start justify-start">
                                        <div class="flex self-stretch space-x-2 items-start justify-start">
                                          <div
                                            class={`text-base leading-normal text-base font-bold leading-normal`}
                                            style={`width: 150px;     
    overflow: hidden;
    line-height: 1,5em;
max-height: 3em;
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 2;
margin-bottom: 6px;`}
                                          >
                                            {value.book_title || "Book Title"}
                                          </div>
                                          <div class="flex self-stretch items-start justify-start">
                                            <img
                                              src="/fimgs/1718_227292.x1.svg"
                                              style="width: 14px; min-width: 14px; max-width: 14px; height: 14px; min-height: 14px; max-height: 14px;"
                                            />
                                            <div
                                              class={`text-sm font-bold leading-tight text-amber-500`}
                                            >
                                              {value.rating_avg.toFixed(2) ||
                                                "-"}
                                            </div>
                                          </div>
                                        </div>
                                        <div class="flex self-stretch items-center justify-start">
                                          <div class="flex space-x-2 items-start justify-start">
                                            <div class="flex items-center justify-center rounded-full">
                                              <div
                                                class={`text-xs font-bold leading-none text-center text-gray-500`}
                                              >
                                                {value
                                                  .tags_books_book_genre_one_idTotags
                                                  .tag_name || "-"}
                                              </div>
                                            </div>
                                            <div class="flex items-center justify-center rounded-full">
                                              {value.tags_books_book_genre_two_idTotags !==
                                                null && (
                                                <div
                                                  class={`text-xs font-bold leading-none text-center text-gray-500`}
                                                >
                                                  {value
                                                    .tags_books_book_genre_two_idTotags
                                                    .tag_name || "-"}
                                                </div>
                                              )}
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="flex self-stretch items-start justify-start">
                                        <div
                                          class={`text-sm font-bold leading-tight text-gray-600`}
                                          style={`overflow: hidden;
    line-height: 1.5em;
max-height: 4.5em;
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 3;`}
                                        >
                                          {value.book_description || "-"}
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                        </div>
                        <div class="flex space-x-2.5 items-start justify-start">
                          <a
                            class="flex flex-col items-start justify-start bg-white prev"
                            onClick={() => {
                              meta.changeRecommend("prev");
                            }}
                            style={`cursor: pointer;
    position: absolute;
    /* width: auto; */
    ${meta.history.length !== 0 ? "top: 275px;" : "top: 143px;"}
    
    padding: 16px 12px;
    /* margin-top: -22px; */
    /* margin-right: 20px; */
    left: 8px;
    color: white;
    background: #d3d3d3de;
    font-weight: bold;
    font-size: 18px;
    transition: 0.6s ease;
    border-radius: 6px;
    user-select: none;`}
                          >
                            <div class={`text-xs font-bold leading-none`}>
                              &#10094;
                            </div>
                          </a>
                          <a
                            class="flex flex-col items-start justify-start bg-white prev"
                            onClick={() => {
                              meta.changeRecommend("next");
                            }}
                            style={`cursor: pointer;
    position: absolute;
    /* width: auto; */
    ${meta.history.length !== 0 ? "top: 275px;" : "top: 143px;"}
    
    padding: 16px 12px;
    /* margin-top: -22px; */
    /* margin-right: 20px; */
    right: 8px;
    color: white;
    background: #d3d3d3de;
    font-weight: bold;
    font-size: 18px;
    transition: 0.6s ease;
    border-radius: 6px;
    user-select: none;`}
                          >
                            <div class={`text-xs font-bold leading-none`}>
                              &#10095;
                            </div>
                          </a>
                        </div>
                      </div>
                    )}
                    {meta.loading && (
                      <div
                        class={`flex self-stretch space-x-4 items-start justify-start p-4 shadow rounded`}
                      >
                        <div
                          class={`flex items-start justify-start`}
                          style="width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;"
                        >
                          <loading-box />
                        </div>
                        <div class="flex flex-1 self-stretch flex-col items-start justify-center">
                          <div class="flex self-stretch flex-col space-y-2 items-start justify-start">
                            <div class="flex self-stretch flex-col space-y-2.5 items-start justify-start">
                              <div
                                class={`flex self-stretch flex-col items-start justify-start`}
                                style={`height: 24px; min-height: 24px; max-height: 24px; max-width:80%;`}
                              >
                                <loading-box />
                              </div>
                              <div class="flex self-stretch flex-col items-start justify-start">
                                <div
                                  class={`flex self-stretch items-center justify-start`}
                                  style={`height: 18px; min-height: 18px; max-height: 18px; max-width:40%;`}
                                >
                                  <loading-box />
                                </div>
                              </div>
                            </div>
                            <div
                              class="flex self-stretch flex-col items-start justify-start"
                              style="height: 100px; min-height: 100px; max-height: 100px;"
                            >
                              <loading-box />
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                    <div class="flex flex-col items-start justify-start">
                      <div class="flex space-x-1.5 justify-center">
                        <div class="bg-amber-500 rounded-full" />
                        <div class="bg-warmGray-300 rounded-full" />
                        <div class="bg-warmGray-300 rounded-full" />
                        <div class="bg-warmGray-300 rounded-full" />
                        <div class="bg-warmGray-300 rounded-full" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
          {meta.popularBook.length !== 0 && (
            <div
              class={`flex self-stretch flex-col space-y-2 items-start justify-start p-6 bg-gray-50`}
            >
              <div class="flex self-stretch space-x-2.5 items-end justify-start rounded-lg">
                <div class="flex flex-1 items-center justify-start">
                  <div
                    class={`text-xl font-bold leading-loose`}
                    onClick={() => {
                      navigate("/m/popular-page");
                    }}
                  >
                    Popular
                  </div>
                </div>
                <div
                  class={`flex self-stretch items-center justify-start`}
                  onClick={() => {
                    navigate("/m/popular-page");
                  }}
                >
                  <div class="text-base font-bold leading-normal text-amber-500">
                    See more
                  </div>
                </div>
              </div>
              {!meta.loading && (
                <div
                  class={`flex self-stretch flex-col space-y-3 items-start justify-start py-4 overflow-x-auto`}
                >
                  <div
                    class={`flex flex-1 space-x-3 items-start justify-start`}
                  >
                    {meta.popularBook
                      .slice(
                        0,
                        meta.popularBook.length > 5
                          ? 5
                          : meta.popularBook.length
                      )
                      .map((value, index) => {
                        if (
                          value.rating_avg !== 0 &&
                          value.viewBook.length !== 0
                        ) {
                          return (
                            <div
                              class={`flex flex-col space-y-1 items-start justify-start px-1 pt-1 pb-2.5 bg-white rounded shadow`}
                              onClick={() => {
                                navigate(
                                  "/m/detail-book-page/" + value.book_id + "/"
                                );
                              }}
                            >
                              <img
                                src={
                                  value.book_picture
                                    ? "/upload/" + value.book_picture
                                    : "/fimgs/1718_224584.x1.png"
                                }
                                style={`width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat; border-radius: 4%`}
                                onError={(e) => {
                                  e.target.onerror = null;
                                  e.target.src = "/fimgs/1718_224584.x1.png";
                                }}
                              />
                              <div class="flex flex-1 self-stretch flex-col space-y-1 items-start justify-start px-2 pb-2">
                                <div class="flex items-start justify-start">
                                  <div class="flex items-center justify-center rounded-full">
                                    <div
                                      class={`text-xs font-medium leading-none text-center text-gray-500`}
                                    >
                                      {value.tags_books_book_genre_one_idTotags
                                        .tag_name || "Genre"}
                                    </div>
                                  </div>
                                </div>
                                <div
                                  class={`flex self-stretch items-start justify-start`}
                                  style={`height: 3.5em;`}
                                >
                                  <div
                                    class={`text-sm font-medium leading-tight`}
                                    style={`width: 100px;     
    overflow: hidden;
    line-height: 1em;
max-height: 3em;
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 3;`}
                                  >
                                    {value.book_title || "Book Title"}
                                  </div>
                                </div>
                                <div class="flex self-stretch space-x-2 items-center justify-start">
                                  <div class="flex items-center justify-center">
                                    <div class="flex space-x-0.5 items-center justify-center pr-0.5">
                                      <img
                                        src="/fimgs/1718_224593.x1.svg"
                                        class="flex items-center justify-center"
                                        style="width: 12px; min-width: 12px; max-width: 12px; height: 12px; min-height: 12px; max-height: 12px;"
                                      />
                                      <div class={`text-xs leading-none`}>
                                        {typeof value.rating_avg == "number" &&
                                        value.rating_avg !== undefined &&
                                        value.rating_avg !== null
                                          ? value.rating_avg.toFixed(2)
                                          : "0.00"}
                                      </div>
                                    </div>
                                  </div>
                                  <div class="flex items-center justify-center">
                                    <img
                                      src="/fimgs/4000_79452.x1.svg"
                                      class={`flex flex-col items-start justify-start pr-0.5`}
                                    />
                                    <div
                                      class={`text-xs leading-none text-center`}
                                    >
                                      {value.viewBook.length > 999
                                        ? value.viewBook.length / 1000 + "k"
                                        : value.viewBook.length}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          );
                        }
                      })}
                    <div
                      class={`flex self-stretch flex-col items-center justify-center px-1 pt-1 pb-2.5 bg-white rounded`}
                      onClick={() => {
                        navigate("/m/popular-page");
                      }}
                    >
                      <div
                        class="flex flex-1 self-stretch flex-col space-y-1 items-center justify-center"
                        style="width: 110.16px; min-width: 110.16px; max-width: 110.16px;"
                      >
                        <div class="text-xs leading-none text-center text-gray-500">
                          Show all Popular
                        </div>
                        <div class="flex flex-col items-center justify-center bg-white border-2 rounded-full border-gray-300">
                          <div class="flex items-start justify-start">
                            <div />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {meta.popularBook.length === 0 && (
                    <div
                      class={`flex self-stretch flex-col items-center justify-center`}
                    >
                      <div class="text-xs leading-none text-center">
                        No books published.
                      </div>
                    </div>
                  )}
                </div>
              )}
              {meta.loading && (
                <div
                  class={`flex self-stretch space-x-3 items-start justify-start overflow-x-auto`}
                >
                  <div
                    class={`flex self-stretch flex-col space-y-1 items-start justify-start px-1 pt-1 pb-2.5 bg-white rounded`}
                    onClick={() => {
                      navigate("/m/detail-book-page");
                    }}
                  >
                    <div
                      class="flex items-start justify-start"
                      style="width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;"
                    >
                      <loading-box
                        style={`background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat;`}
                      />
                    </div>
                    <div class="flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-start px-2 pb-2">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 75px; min-width: 75px; max-width: 75px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 94.16px; min-width: 94.16px; max-width: 94.16px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex self-stretch space-x-2 items-center justify-center">
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class={`flex self-stretch flex-col space-y-1 items-start justify-start px-1 pt-1 pb-2.5 bg-white rounded`}
                    onClick={() => {
                      navigate("/m/detail-book-page");
                    }}
                  >
                    <div
                      class="flex items-start justify-start"
                      style="width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;"
                    >
                      <loading-box
                        style={`background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat;`}
                      />
                    </div>
                    <div class="flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-start px-2 pb-2">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 75px; min-width: 75px; max-width: 75px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 94.16px; min-width: 94.16px; max-width: 94.16px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex self-stretch space-x-2 items-center justify-center">
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class={`flex self-stretch flex-col space-y-1 items-start justify-start px-1 pt-1 pb-2.5 bg-white rounded`}
                    onClick={() => {
                      navigate("/m/detail-book-page");
                    }}
                  >
                    <div
                      class="flex items-start justify-start"
                      style="width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;"
                    >
                      <loading-box
                        style={`background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat;`}
                      />
                    </div>
                    <div class="flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-start px-2 pb-2">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 75px; min-width: 75px; max-width: 75px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 94.16px; min-width: 94.16px; max-width: 94.16px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex self-stretch space-x-2 items-center justify-center">
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class={`flex self-stretch flex-col space-y-1 items-start justify-start px-1 pt-1 pb-2.5 bg-white rounded`}
                    onClick={() => {
                      navigate("/m/detail-book-page");
                    }}
                  >
                    <div
                      class="flex items-start justify-start"
                      style="width: 110.16px; min-width: 110.16px; max-width: 110.16px; height: 157.61px; min-height: 157.61px; max-height: 157.61px;"
                    >
                      <loading-box
                        style={`background-image: url('/fimgs/bg-faa07871d0024ca0a958943ad719b21cfec79189');background-size:100% 100%;background-repeat:no-repeat;`}
                      />
                    </div>
                    <div class="flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-start px-2 pb-2">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 75px; min-width: 75px; max-width: 75px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 94.16px; min-width: 94.16px; max-width: 94.16px; height: 12px; min-height: 12px; max-height: 12px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex self-stretch space-x-2 items-center justify-center">
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                        <div
                          class="flex flex-col items-start justify-start"
                          style="width: 43.08px; min-width: 43.08px; max-width: 43.08px; height: 12px; min-height: 12px; max-height: 12px;"
                        >
                          <loading-box class="bg-gray-200" />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class={`flex self-stretch flex-col items-center justify-center px-1 pt-1 pb-2.5 bg-white rounded`}
                    onClick={() => {
                      navigate("/m/popular-page");
                    }}
                  >
                    <div
                      class="flex flex-1 self-stretch flex-col space-y-1 items-center justify-center"
                      style="width: 110.16px; min-width: 110.16px; max-width: 110.16px;"
                    >
                      <div class="text-xs leading-none text-center text-gray-500">
                        Show all Popular
                      </div>
                      <div class="flex flex-col items-center justify-center bg-white border-2 rounded-full border-gray-300">
                        <div class="flex items-start justify-start">
                          <div />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}
          <div
            class={`flex self-stretch flex-col space-y-2 items-start justify-start p-6 bg-orange-50`}
            style={"margin-bottom: 40px;"}
          >
            <div class="flex self-stretch space-x-2.5 items-end justify-start">
              <div class="flex flex-1 items-center justify-start">
                <div class="text-xl font-bold leading-loose">New Releases</div>
              </div>
              <div class="flex flex-1 self-stretch items-center justify-end">
                <div class="text-base font-bold leading-normal text-right text-amber-500">
                  See more
                </div>
              </div>
            </div>
            {!meta.loading && (
              <div
                class={`flex self-stretch flex-col space-y-2.5 items-center justify-center`}
                id={`wrapper`}
              >
                {meta.newReleaseBook.length !== 0 &&
                  meta.newReleaseBook
                    .slice(0, meta.new_releases_length)
                    .map((value, index) => {
                      return (
                        <div
                          class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                        >
                          <img
                            src={
                              value.book_picture
                                ? "/upload/" + value.book_picture
                                : "/fimgs/1718_224584.x1.png"
                            }
                            style={`width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;`}
                            onError={(e) => {
                              e.target.onerror = null;
                              e.target.src = "/fimgs/1718_224584.x1.png";
                            }}
                            class={`flex items-start justify-start`}
                            onClick={() => {
                              navigate(
                                "/m/detail-book-page/" + value.book_id + "/"
                              );
                            }}
                          />
                          <div
                            class={`flex flex-1 flex-col space-y-1 items-start justify-start`}
                            onClick={() => {
                              navigate(
                                "/m/detail-book-page/" + value.book_id + "/"
                              );
                            }}
                          >
                            <div class="flex self-stretch items-start justify-start">
                              <div
                                class={`text-base font-bold leading-normal`}
                                style={`display: block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;`}
                              >
                                {value.book_title || "Book Title"}
                              </div>
                            </div>
                            <div class="flex self-stretch space-x-2 items-center justify-start">
                              <div
                                class={`flex self-stretch items-start justify-start`}
                                style={`border-right: 0.5px solid #D4D4D8;
    padding-right: 8px;
    padding-bottom: 2px;`}
                              >
                                <div class="flex items-center justify-center rounded-full">
                                  <div
                                    class={`text-xs font-medium leading-none text-center text-gray-500`}
                                  >
                                    {value.category.category_name || "-  "}
                                  </div>
                                </div>
                              </div>
                              <div class="flex self-stretch items-start justify-start rounded-full">
                                <div class="flex items-center justify-center rounded-full">
                                  <div
                                    class={`text-xs font-medium leading-none text-center text-gray-500`}
                                  >
                                    {value.tags_books_book_genre_one_idTotags
                                      .tag_name || "Genre"}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                {meta.newReleaseBook.length === 0 && (
                  <div
                    class={`flex self-stretch flex-col items-center justify-center`}
                  >
                    <div class="text-xs leading-none text-center">
                      No books published.
                    </div>
                  </div>
                )}
                {meta.newReleaseBook.length > meta.new_releases_length && (
                  <m-button
                    preloader={true}
                    loading={meta.showMoreNewReleases}
                    onClick={() => {
                      meta.showMore("NewReleases");
                    }}
                    class={`flex items-center justify-center p-1 bg-gray-300 rounded-md`}
                    style={`text-transform: capitalize;
  padding: 8px;
  padding-right: 12px!important;
    color: white;
    background: #dededede;
    font-weight: bold;
    font-size: 18px;
    transition: 0.6s ease;
    border-radius: 6px;
    user-select: none;`}
                  >
                    <div
                      class={`text-xs font-medium leading-none text-center text-white`}
                    >
                      Show More
                    </div>
                  </m-button>
                )}
              </div>
            )}
            {meta.loading && (
              <div
                class={`flex self-stretch flex-col space-y-2.5 items-start justify-start`}
              >
                <div
                  class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                >
                  <div class={`flex items-start justify-start`}>
                    <div
                      class="flex flex-1 self-stretch items-start justify-start"
                      style="width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;"
                    >
                      <loading-box style="background-image: url('/fimgs/bg-1cf452be1c924b48e1ebc8f542367afcc8b29932');background-size:100% 100%;background-repeat:no-repeat;" />
                    </div>
                  </div>
                  <div class="flex flex-1 flex-col space-y-1 items-start justify-start">
                    <div
                      class="flex self-stretch flex-col items-start justify-start"
                      style="width: 302.60px; min-width: 302.60px; max-width: 302.60px; height: 17px; min-height: 17px; max-height: 17px;"
                    >
                      <loading-box class="bg-gray-200" />
                    </div>
                    <div class="flex self-stretch space-x-2 items-center justify-start">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex flex-col items-start justify-start">
                        <loading-box
                          class="bg-gray-200"
                          style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                >
                  <div class={`flex items-start justify-start`}>
                    <div
                      class="flex flex-1 self-stretch items-start justify-start"
                      style="width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;"
                    >
                      <loading-box style="background-image: url('/fimgs/bg-1cf452be1c924b48e1ebc8f542367afcc8b29932');background-size:100% 100%;background-repeat:no-repeat;" />
                    </div>
                  </div>
                  <div class="flex flex-1 flex-col space-y-1 items-start justify-start">
                    <div
                      class="flex self-stretch flex-col items-start justify-start"
                      style="width: 302.60px; min-width: 302.60px; max-width: 302.60px; height: 17px; min-height: 17px; max-height: 17px;"
                    >
                      <loading-box class="bg-gray-200" />
                    </div>
                    <div class="flex self-stretch space-x-2 items-center justify-start">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex flex-col items-start justify-start">
                        <loading-box
                          class="bg-gray-200"
                          style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                >
                  <div class={`flex items-start justify-start`}>
                    <div
                      class="flex flex-1 self-stretch items-start justify-start"
                      style="width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;"
                    >
                      <loading-box style="background-image: url('/fimgs/bg-1cf452be1c924b48e1ebc8f542367afcc8b29932');background-size:100% 100%;background-repeat:no-repeat;" />
                    </div>
                  </div>
                  <div class="flex flex-1 flex-col space-y-1 items-start justify-start">
                    <div
                      class="flex self-stretch flex-col items-start justify-start"
                      style="width: 302.60px; min-width: 302.60px; max-width: 302.60px; height: 17px; min-height: 17px; max-height: 17px;"
                    >
                      <loading-box class="bg-gray-200" />
                    </div>
                    <div class="flex self-stretch space-x-2 items-center justify-start">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex flex-col items-start justify-start">
                        <loading-box
                          class="bg-gray-200"
                          style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                >
                  <div class={`flex items-start justify-start`}>
                    <div
                      class="flex flex-1 self-stretch items-start justify-start"
                      style="width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;"
                    >
                      <loading-box style="background-image: url('/fimgs/bg-1cf452be1c924b48e1ebc8f542367afcc8b29932');background-size:100% 100%;background-repeat:no-repeat;" />
                    </div>
                  </div>
                  <div class="flex flex-1 flex-col space-y-1 items-start justify-start">
                    <div
                      class="flex self-stretch flex-col items-start justify-start"
                      style="width: 302.60px; min-width: 302.60px; max-width: 302.60px; height: 17px; min-height: 17px; max-height: 17px;"
                    >
                      <loading-box class="bg-gray-200" />
                    </div>
                    <div class="flex self-stretch space-x-2 items-center justify-start">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex flex-col items-start justify-start">
                        <loading-box
                          class="bg-gray-200"
                          style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class={`flex self-stretch space-x-2 items-center justify-start p-2 bg-white rounded`}
                >
                  <div class={`flex items-start justify-start`}>
                    <div
                      class="flex flex-1 self-stretch items-start justify-start"
                      style="width: 36.40px; min-width: 36.40px; max-width: 36.40px; height: 52px; min-height: 52px; max-height: 52px;"
                    >
                      <loading-box style="background-image: url('/fimgs/bg-1cf452be1c924b48e1ebc8f542367afcc8b29932');background-size:100% 100%;background-repeat:no-repeat;" />
                    </div>
                  </div>
                  <div class="flex flex-1 flex-col space-y-1 items-start justify-start">
                    <div
                      class="flex self-stretch flex-col items-start justify-start"
                      style="width: 302.60px; min-width: 302.60px; max-width: 302.60px; height: 17px; min-height: 17px; max-height: 17px;"
                    >
                      <loading-box class="bg-gray-200" />
                    </div>
                    <div class="flex self-stretch space-x-2 items-center justify-start">
                      <div
                        class="flex flex-col items-start justify-start"
                        style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                      >
                        <loading-box class="bg-gray-200" />
                      </div>
                      <div class="flex flex-col items-start justify-start">
                        <loading-box
                          class="bg-gray-200"
                          style="width: 24px; min-width: 24px; max-width: 24px; height: 17px; min-height: 17px; max-height: 17px;"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </m-tab>
        <m-tab
          class={`flex flex-1 self-stretch flex-col items-start justify-start`}
          id="explore"
        >
          <div class="flex self-stretch flex-col items-start justify-start">
            <div class="flex self-stretch flex-col items-start justify-start">
              <div
                class={`flex self-stretch items-center justify-center`}
                style={"margin-top:20px;"}
              >
                <m-link
                  class={`flex flex-1 self-stretch flex-col space-y-2.5 items-start justify-start`}
                  tabLink="#categories"
                  onClick={(e) => {
                    meta.onClickTabExplore("categories");
                  }}
                  tabLinkActive={meta.tabActiveExplore === "categories"}
                  href={""}
                >
                  {meta.tabActiveExplore === "categories" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center bg-white`}
                      style={`padding:8px; border-bottom: 3px solid black; border-bottom-color: #feca57`}
                    >
                      <div class="text-base leading-normal text-center text-amber-500">
                        Categories
                      </div>
                    </div>
                  )}
                  {meta.tabActiveExplore !== "categories" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center`}
                      style={
                        "padding:8px; border-bottom: 3px solid black; border-bottom-color: #f5f6fa"
                      }
                    >
                      <div class="text-base leading-normal text-center text-gray-900">
                        Categories
                      </div>
                    </div>
                  )}
                </m-link>
                <m-link
                  class={`flex flex-1 self-stretch flex-col space-y-2.5 items-start justify-start`}
                  tabLink="#genres"
                  onClick={(e) => meta.onClickTabExplore("genres")}
                  tabLinkActive={meta.tabActiveExplore === "genres"}
                  href={""}
                >
                  {meta.tabActiveExplore === "genres" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center`}
                      style={
                        "padding:8px; border-bottom: 3px solid black; border-bottom-color: #feca57;"
                      }
                    >
                      <div class="text-base leading-normal text-center text-amber-500">
                        Genres
                      </div>
                    </div>
                  )}
                  {meta.tabActiveExplore !== "genres" && (
                    <div
                      class={`flex self-stretch flex-col space-y-2.5 items-center justify-center bg-white`}
                      style={`padding:8px; border-bottom: 3px solid black; border-bottom-color: #f5f6fa;`}
                    >
                      <div class="text-base leading-normal text-center text-gray-900">
                        Genres
                      </div>
                    </div>
                  )}
                </m-link>
              </div>
            </div>
            <m-tabs
              class={`flex flex-1 self-stretch flex-col items-center justify-center pt-4`}
              swipeable={true}
            >
              <m-tab
                class={`flex flex-1 self-stretch flex-col items-center justify-start px-6`}
                id="categories"
                style="margin-top:25px;"
              >
                <div />
              </m-tab>
              <m-tab
                class={`flex flex-1 self-stretch flex-col items-center justify-start px-6`}
                id="genres"
                style="margin-top:25px;"
              >
                <div />
              </m-tab>
            </m-tabs>
          </div>
        </m-tab>
        <m-tab
          class={`flex flex-1 self-stretch flex-col items-start justify-start`}
          id="pyriList"
        >
          <div class="flex self-stretch flex-col items-start justify-start">
            <div class="flex self-stretch flex-col items-start justify-start">
              <div
                class={`flex self-stretch items-center justify-center`}
                style={"margin-top:20px;"}
              >
                <m-link
                  class={`flex flex-1 self-stretch flex-col space-y-2.5 items-start justify-start`}
                  tabLink="#history"
                  onClick={(e) => meta.onClickTabPyri("history")}
                  tabLinkActive={meta.tabActivePyri === "history"}
                >
                  {meta.tabActivePyri === "history" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center bg-white`}
                      style={`padding:8px; border-bottom: 3px solid black; border-bottom-color: #feca57`}
                    >
                      <div class="text-base leading-normal text-center text-amber-500">
                        History
                      </div>
                    </div>
                  )}
                  {meta.tabActivePyri !== "history" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center`}
                      style={
                        "padding:8px; border-bottom: 3px solid black; border-bottom-color: #f5f6fa"
                      }
                    >
                      <div class="text-base leading-normal text-center text-gray-900">
                        History
                      </div>
                    </div>
                  )}
                </m-link>
                <m-link
                  class={`flex flex-1 self-stretch flex-col space-y-2.5 items-start justify-start`}
                  tabLink="#read-later"
                  onClick={(e) => meta.onClickTabPyri("read-later")}
                  tabLinkActive={meta.tabActivePyri === "read-later"}
                >
                  {meta.tabActivePyri === "read-later" && (
                    <div
                      class={`flex flex-1 self-stretch flex-col space-y-2.5 items-center justify-center`}
                      style={
                        "padding:8px; border-bottom: 3px solid black; border-bottom-color: #feca57;"
                      }
                    >
                      <div class="text-base leading-normal text-center text-amber-500">
                        Read Later
                      </div>
                    </div>
                  )}
                  {meta.tabActivePyri !== "read-later" && (
                    <div
                      class={`flex self-stretch flex-col space-y-2.5 items-center justify-center bg-white`}
                      style={`padding:8px; border-bottom: 3px solid black; border-bottom-color: #f5f6fa;`}
                    >
                      <div class="text-base leading-normal text-center text-gray-900">
                        Read Later
                      </div>
                    </div>
                  )}
                </m-link>
              </div>
            </div>
            <m-tabs
              class={`flex flex-1 self-stretch flex-col space-y-5 items-center justify-center pt-4`}
              swipeable={true}
            >
              <m-tab
                class={`flex flex-1 self-stretch flex-col space-y-3 items-center justify-start px-6`}
                id="history"
                style="margin-top:25px;"
              >
                {meta.history.map((value, i) => {
                  return (
                    <div
                      class={`flex space-x-4 items-start justify-start p-2 bg-white shadow shadow-inner rounded`}
                      onClick={() => {
                        var birthday = new Date(window.user.user.user_birthday);
                        var ageDifMs = Date.now() - birthday.getTime();
                        var ageDate = new Date(ageDifMs);
                        var userAge = Math.abs(ageDate.getUTCFullYear() - 1970);

                        if (
                          meta.user_premium.length !== 0 &&
                          new Date(meta.user_premium.expired_date).getTime() >=
                            new Date().getTime()
                        ) {
                          if (userAge < value.books.book_age_restriction) {
                            meta.toast(
                              "You are not old enough to access this book. You must be at least " +
                                value.books.book_age_restriction +
                                " years or older.",
                              "center",
                              2000
                            );
                          } else {
                            window.mobileApp.app.dialog.preloader("Loading...");
                            navigate(
                              "/m/read-book-page/" +
                                value.books.book_id +
                                "/history"
                            );
                            setTimeout(() => {
                              window.mobileApp.app.dialog.close();
                            }, 2000);
                          }
                        } else {
                          if (userAge < value.books.book_age_restriction) {
                            meta.toast(
                              "You are not old enough to access this book. You must be at least " +
                                value.books.book_age_restriction +
                                " years or older.",
                              "center",
                              2000
                            );
                          } else {
                            meta.readHistoryFree(value.books.book_id);
                          }
                        }
                      }}
                    >
                      <div
                        class="flex items-start justify-start"
                        style="width: 65px; min-width: 65px; max-width: 65px; height: 93px; min-height: 93px; max-height: 93px;"
                      >
                        <img
                          style={`width:100%;
height:100%;
object-fit: cover;
border-radius: 8%`}
                          src={
                            value.books.book_picture
                              ? "/upload/" + value.books.book_picture
                              : "/fimgs/I1545_47723_1812_36071.x1.png"
                          }
                          onError={(e) => {
                            e.target.src =
                              "/fimgs/I1545_47723_1812_36071.x1.png";
                          }}
                        />
                      </div>
                      <div class="flex flex-1 self-stretch flex-col space-y-1.5 items-start justify-center">
                        <div class="flex self-stretch flex-col items-start justify-start">
                          <div class="flex self-stretch space-x-2 items-start justify-start">
                            <div
                              class={`text-sm font-medium leading-tight w-full`}
                            >
                              {value.books.book_title || "Book title"}
                            </div>
                            {meta.freeBook !== null &&
                              compareAsc(
                                new Date(),
                                new Date(
                                  dateAdd(
                                    new Date(
                                      meta.freeBook.freeBook_date_registered
                                    ),
                                    {
                                      months: 1,
                                    }
                                  )
                                )
                              ) === -1 &&
                              meta.user_premium.length === 0 &&
                              i < 3 && (
                                <m-badge
                                  class={`flex self-stretch flex-col items-start justify-start bg-white`}
                                >
                                  <div
                                    class={`text-sm font-medium leading-tight`}
                                    style={`--tw-bg-opacity: 1;
    color: rgba(245,158,11,var(--tw-bg-opacity));`}
                                  >
                                    Free
                                  </div>
                                </m-badge>
                              )}
                          </div>
                          <div
                            class={`flex flex-1 self-stretch items-center justify-start rounded-full`}
                            style="margin-top:10px;"
                          >
                            <div
                              class={`text-xs font-medium leading-none text-gray-500`}
                            >
                              {value.books
                                .authors_authorsTobooks_book_author_one_id
                                .author_name || "-"}
                            </div>
                          </div>
                        </div>
                        <div class="flex self-stretch items-start justify-start">
                          <div class={`text-sm leading-tight text-gray-600`}>
                            Last read on page {meta.pages[i] || "-"}
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
                {meta.history.length === 0 && (
                  <div
                    class={`flex flex-1 self-stretch items-start justify-center px-2 py-5 shadow shadow-inner rounded w-full h-full`}
                  >
                    <div
                      class={`text-sm leading-tight text-center text-gray-600`}
                    >
                      No history.
                    </div>
                  </div>
                )}
              </m-tab>
              <m-tab
                class={`flex flex-1 self-stretch flex-col items-center justify-start px-6`}
                id="read-later"
                style="margin-top:25px;"
              >
                {meta.bookmarks.map((value, i) => {
                  return (
                    <div
                      class={`flex self-stretch flex-col items-start justify-start p-2 bg-white shadow shadow-inner rounded`}
                    >
                      <div class="flex self-stretch space-x-4 items-start justify-start">
                        <div class="flex self-stretch items-start justify-start">
                          <img
                            src={
                              "/upload/" + value.books.book_picture ||
                              "/fimgs/3790_234402.x1.png"
                            }
                            style={`border-radius:8%; width:65px; height:93px;`}
                            onError={(e) => {
                              e.target.src = "/fimgs/3790_234402.x1.png";
                            }}
                          />
                        </div>
                        <div class="flex flex-1 self-stretch flex-col space-y-1.5 items-start justify-start">
                          <div class="flex flex-1 self-stretch flex-col items-start justify-start">
                            <div class="flex self-stretch flex-col items-start justify-start">
                              <div class="flex self-stretch items-start justify-start">
                                <div
                                  class={`text-sm font-medium leading-tight`}
                                >
                                  {value.books.book_title || "Book Name"}
                                </div>
                              </div>
                            </div>
                            <div
                              class={`flex self-stretch items-center justify-start`}
                              style="margin-top:10px;"
                            >
                              <div class="flex items-start justify-start">
                                <div class="flex items-center justify-center rounded-full">
                                  <div
                                    class={`text-xs font-medium leading-none text-center text-gray-500`}
                                  >
                                    {value.books
                                      .authors_authorsTobooks_book_author_one_id
                                      ? value.books
                                          .authors_authorsTobooks_book_author_one_id
                                          .author_name
                                      : "Author"}{" "}
                                    {value.books
                                      .authors_authorsTobooks_book_author_two_id
                                      ? value.books
                                          .authors_authorsTobooks_book_author_two_id
                                          .author_name
                                      : ""}{" "}
                                    {value.books
                                      .authors_authorsTobooks_book_author_three_id
                                      ? value.books
                                          .authors_authorsTobooks_book_author_three_id
                                          .author_name
                                      : ""}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="flex self-stretch space-x-2 items-start justify-start">
                            <div
                              class={`flex flex-1 items-center justify-center px-4 py-2.5 bg-white shadow border rounded border-amber-500`}
                              onClick={() => {
                                navigate(
                                  "/m/detail-book-page/" + value.books.book_id
                                );
                              }}
                            >
                              <div class="text-xs font-bold leading-none text-center text-amber-500">
                                Read Now
                              </div>
                            </div>
                            <div
                              class={`flex items-start justify-start px-1.5 py-1 bg-white shadow border rounded border-gray-400`}
                              onClick={() => {
                                meta.deleteBookmark(value.bookmark_id);
                              }}
                            >
                              <ficon
                                aria-label="Delete"
                                iconName="Delete"
                                class={`flex items-center justify-center`}
                                style="font-size:14px; "
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </m-tab>
            </m-tabs>
          </div>
        </m-tab>
        <m-tab
          class={`flex flex-1 self-stretch flex-col space-y-2.5 items-start justify-start px-6 pt-2`}
          id="profile"
          style={`height: 1201px; min-height: 1201px; max-height: 1201px; padding-top:1rem`}
        >
          <div class="flex self-stretch space-x-2.5 items-center justify-start">
            <div
              src="/fimgs/1228_38484.x1.svg"
              class={`flex flex-col items-start justify-start`}
            >
              <img
                class={`flex items-start justify-start rounded-full h-24 w-24`}
                src={
                  meta.user.user_picture
                    ? "/upload/" + meta.user.user_picture
                    : "/fimgs/1228_310692.x1.png"
                }
                style={`border: 1px solid #555;`}
                onError={(e) => {
                  e.target.onerror = null;
                  e.target.src = "/fimgs/1228_310692.x1.png";
                }}
              />
            </div>
            <div class="flex flex-1 self-stretch flex-col items-start justify-center p-4">
              <div class={`text-2xl font-bold leading-9`}>
                {meta.user.user_name || "Username"}
              </div>
              {meta.user_premium.length !== 0 &&
                new Date(meta.user_premium.expired_date).getTime() <=
                  new Date().getTime() && (
                  <div
                    class={`flex items-center justify-center px-4 py-0.5 bg-gray-500 border rounded border-gray-500`}
                  >
                    <div class="text-xs font-bold leading-none text-center text-white">
                      FREE
                    </div>
                  </div>
                )}
              {meta.user_premium.length === 0 && (
                <div
                  class={`flex items-center justify-center px-4 py-0.5 border rounded`}
                  style={`background: #71717A;
border: 1px solid #71717A;
box-sizing: border-box;
border-radius: 5px;`}
                >
                  <div class="text-xs font-bold leading-none text-center text-white">
                    FREE
                  </div>
                </div>
              )}
              {meta.user_premium.length !== 0 &&
                new Date(meta.user_premium.expired_date).getTime() >
                  new Date().getTime() && (
                  <div
                    class={`flex items-center justify-center px-2.5 py-0.5 border rounded`}
                  >
                    <div class="text-xs font-bold leading-none text-center">
                      PRO
                    </div>
                  </div>
                )}
            </div>
          </div>
          <div
            class={`flex self-stretch flex-col space-y-4 items-start justify-start transform -rotate-180 px-4 py-4 bg-gray-50 border rounded-lg border-gray-200`}
            onClick={() => {
              navigate("/m/edit-profile");
            }}
          >
            <div class="flex self-stretch flex-col items-start justify-start transform -rotate-180">
              <div class="flex self-stretch items-center justify-center">
                <div class="flex flex-1 items-start justify-start">
                  <div class="text-base font-bold leading-normal">
                    Pyri Account
                  </div>
                </div>
                <img
                  src="/fimgs/1228_38497.x1.svg"
                  class="flex flex-col items-start justify-start bg-gray-50"
                  style="width: 24px; min-width: 24px; max-width: 24px; height: 24px; min-height: 24px; max-height: 24px;"
                />
              </div>
            </div>
            <div class="flex self-stretch items-center justify-center transform -rotate-180">
              <div class="flex flex-1 flex-col items-start justify-center">
                <div class="text-base font-bold leading-normal text-gray-500">
                  Full Name
                </div>
                <div class={`text-base font-bold leading-normal text-gray-900`}>
                  {meta.user.user_name || "Your Name"}
                </div>
              </div>
            </div>
            <div class="flex self-stretch items-center justify-center transform -rotate-180">
              <div class="flex flex-1 flex-col items-start justify-center">
                <div class="text-base font-bold leading-normal text-gray-500">
                  Email
                </div>
                <div class={`text-base font-bold leading-normal text-gray-900`}>
                  {meta.user.user_email || "Your Email"}
                </div>
              </div>
            </div>
            <div class="flex self-stretch items-center justify-center transform -rotate-180">
              <div class="flex flex-1 flex-col items-start justify-center">
                <div class="text-base font-bold leading-normal text-gray-500">
                  Birthday
                </div>
                <div class={`text-base font-bold leading-normal text-gray-900`}>
                  {dateFormat(
                    new Date(meta.user.user_birthday),
                    "dd MMMM yyyy"
                  ) || "Your Birthday"}
                </div>
              </div>
            </div>
            <div class="flex self-stretch items-center justify-center transform -rotate-180">
              <div class="flex flex-1 flex-col items-start justify-center">
                <div class="text-base font-bold leading-normal text-gray-500">
                  Gender
                </div>
                <div class={`text-base font-bold leading-normal text-gray-900`}>
                  {meta.user["user_gender"] || "Your Gender"}
                </div>
              </div>
            </div>
          </div>
          <div class="flex self-stretch flex-col items-start justify-start transform -rotate-180 px-4 py-4 bg-gray-50 border rounded-lg border-gray-200">
            <div class="flex self-stretch space-x-2.5 items-center justify-start transform -rotate-180">
              <div class="flex flex-1 flex-col items-start justify-center">
                <div class="text-base font-bold leading-normal text-gray-500">
                  Subcription
                </div>
                {meta.user_premium.length !== 0 &&
                  new Date(meta.user_premium.expired_date).getTime() <=
                    new Date().getTime() && (
                    <div
                      class={`text-base font-bold leading-normal text-gray-900`}
                    >
                      User Free
                    </div>
                  )}
                {meta.user_premium.length === 0 && (
                  <div class={`text-base font-bold leading-normal`}>
                    User Free
                  </div>
                )}
                {meta.user_premium.length !== 0 &&
                  new Date(meta.user_premium.expired_date).getTime() >
                    new Date().getTime() && (
                    <div class={`text-base font-bold leading-normal`}>
                      User Pro
                    </div>
                  )}
              </div>
              <div class={`flex flex-col items-end justify-start`}>
                {meta.user_premium.length !== 0 &&
                  new Date(meta.user_premium.expired_date).getTime() <=
                    new Date().getTime() && (
                    <m-button
                      class={`flex items-start justify-start px-2.5 py-0.5 bg-gradient-to-r from-red-600 to-yellow-400 shadow rounded`}
                      style={`background: linear-gradient(90deg, #FF1000 -38.85%, #EFFF00 143.17%); text-transform: capitalize;`}
                      onClick={() => {
                        navigate("/m/premium-page");
                      }}
                    >
                      <div
                        class={`text-base font-bold leading-normal text-white`}
                      >
                        Upgrade to Pro
                      </div>
                    </m-button>
                  )}
                {meta.user_premium.length !== 0 &&
                  new Date(meta.user_premium.expired_date).getTime() >
                    new Date().getTime() && (
                    <m-button
                      class={`flex items-start justify-start px-2.5 py-0.5 shadow rounded`}
                      style={`background: linear-gradient(90deg, #FF1000 -38.85%, #EFFF00 143.17%); text-transform: capitalize;`}
                      onClick={() => {
                        navigate("/m/premium-page");
                      }}
                    >
                      <div
                        class={`text-base font-bold leading-normal text-white`}
                      >
                        Premium
                      </div>
                    </m-button>
                  )}
                {meta.user_premium.length === 0 && (
                  <m-button
                    class={`flex items-start justify-start px-2.5 py-0.5 shadow rounded`}
                    style={`background: linear-gradient(90deg, #FF1000 -38.85%, #EFFF00 143.17%); text-transform: capitalize;`}
                    onClick={() => {
                      navigate("/m/premium-page");
                    }}
                  >
                    <div
                      class={`text-base font-bold leading-normal text-white`}
                    >
                      Upgrade to Pro
                    </div>
                  </m-button>
                )}
              </div>
            </div>
          </div>
          <div class="flex self-stretch flex-col items-start justify-start transform -rotate-180 px-4 py-4 bg-gray-50 border rounded-lg border-gray-200">
            <div
              class={`flex self-stretch items-center justify-start transform -rotate-180`}
              onClick={() => {
                navigate("/m/change-interest");
              }}
            >
              <div class="flex flex-1 flex-col space-y-1.5 items-start justify-center">
                <div class="flex self-stretch space-x-2.5 items-center justify-center">
                  <div class="text-base font-bold leading-normal">
                    Your Interest
                  </div>
                  <div class="flex flex-1 flex-col items-end justify-start bg-gray-50">
                    <img
                      src="/fimgs/1437_6937.x1.svg"
                      style="width: 24px; min-width: 24px; max-width: 24px; height: 11.98px; min-height: 11.98px; max-height: 11.98px;"
                    />
                  </div>
                </div>
                <div class="flex self-stretch flex-col space-y-1.5 items-start justify-start">
                  <div id="kotak" />
                  {meta.loadingInterest && (
                    <div
                      class={`flex self-stretch flex-col items-start justify-start`}
                      style={`height: 22px; min-height: 22px; max-height: 22px;`}
                    >
                      <loading-box />
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
          {window.user.role !== "guest" && (
            <div
              class={`flex self-stretch flex-col items-start justify-start transform -rotate-180`}
              style={`--tw-rotate: 0deg;`}
            >
              <btnlogout
                class={`flex flex-col items-center justify-center transform -rotate-180 py-1.5 pl-4 pr-6 bg-red-600 shadow rounded`}
                style={`background: #FF1000`}
                onClick={meta.logout}
              />
            </div>
          )}
        </m-tab>
      </m-tabs>
      <div
        class={`flex flex-col items-center justify-start pt-2 pb-4 bg-white bg-opacity-50 shadow-inner fixed w-full bottom-0`}
        style={"backdrop-filter : blur(70px);"}
      >
        <div class="flex self-stretch items-center justify-center">
          <m-link
            class={`flex flex-1 flex-col space-y-2.5 items-center justify-center`}
            tabLink="#home"
            onClick={(e) => meta.onClickTab("home")}
            tabLinkActive={meta.tabActive === "home"}
          >
            {meta.tabActive === "home" && (
              <img
                src="/fimgs/1237_94968.x1.svg"
                class={`flex flex-col items-center justify-center rounded-full`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
            {meta.tabActive !== "home" && (
              <img
                src="/fimgs/1235_12411.x1.svg"
                class={`flex flex-col items-center justify-center rounded-full`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
          </m-link>
          <m-link
            class={`flex flex-1 flex-col space-y-2.5 items-start justify-start`}
            tabLink="#pyriList"
            onClick={(e) => meta.onClickTab("pyriList")}
            tabLinkActive={meta.tabActive === "pyriList"}
          >
            {meta.tabActive === "pyriList" && (
              <img
                src="/fimgs/711_3304.x1.svg"
                class={`flex flex-col items-center justify-center`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
            {meta.tabActive !== "pyriList" && (
              <img
                src="/fimgs/1235_12460.x1.svg"
                class={`flex flex-col items-center justify-center`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
          </m-link>
          <m-link
            class={`flex flex-1 flex-col space-y-2.5 items-start justify-start`}
            tabLink="#explore"
            onClick={(e) => meta.onClickTab("explore")}
            tabLinkActive={meta.tabActive === "explore"}
          >
            {meta.tabActive === "explore" && (
              <img
                src="/fimgs/1235_12502.x1.svg"
                class={`flex self-stretch flex-col items-center justify-center`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
            {meta.tabActive !== "explore" && (
              <img
                src="/fimgs/711_3309.x1.svg"
                class={`flex self-stretch flex-col items-center justify-center`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
          </m-link>
          <m-link
            class={`flex flex-1 flex-col items-center justify-center`}
            tabLink={window.user.role === "guest" ? "#null" : "#profile"}
            tabLinkActive={meta.tabActive === "profile"}
            onClick={(e) => meta.onClickTab("profile")}
          >
            {meta.tabActive === "profile" && (
              <img
                src="/fimgs/711_3314.x1.svg"
                class={`flex flex-col items-center justify-center rounded-full`}
                style={`width: 94.75px; min-width: 94.75px; max-width: 94.75px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
            {meta.tabActive !== "profile" && (
              <img
                src="/fimgs/1237_46216.x1.svg"
                class={`flex flex-col items-center justify-center rounded-full`}
                style={`width: 63.17px; min-width: 63.17px; max-width: 63.17px; height: 42px; min-height: 42px; max-height: 42px;`}
              />
            )}
          </m-link>
        </div>
      </div>
    </div>
  </div>
</>