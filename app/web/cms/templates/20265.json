{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  // console.log(req.body);\n  // const users = req.body;\n  let { users, e } = req?.body;\n  let res = \"Failure\";\n  if (e === \"Register\") {\n    const createUser = await db.users.create({ data: users }); //insert database\n    res = \"Register Success\";\n  }\n  if (e === \"Login\") {\n    const loggedUser = await db.users.findFirst({\n      where: {\n        user_email: users.user_email,\n        user_password: users.user_password,\n      },\n    });\n    users = loggedUser ? { ...loggedUser } : null;\n    user.user = { role: \"users\", user: { ...loggedUser } };\n    res = \"Login Success\";\n  }\n  if (e === \"Update\") {\n    const updateUser = await db.users.update({\n      where: {\n        user_id: users.user_id,\n      },\n      data: users,\n    });\n    // console.log(updateUser);\n    users = updateUser;\n    user.user = { role: \"users\", user: { ...updateUser } };\n    res = \"Update Success\";\n  }\n  if (e === \"ReadMany\") {\n    users = await db.users.findMany({});\n    res = \"Read All Success\";\n  }\n  if (e === \"FindEmail\") {\n    users = await db.users.findFirst({\n      where: {\n        user_email: users.user_email,\n      },\n    });\n    res = users !== null ? \"Email Found\" : \"Email Not Found\";\n  }\n  if (e === \"SetForgotToken\") {\n    users = await db.users.update({\n      where: {\n        user_id: users.user_id,\n      },\n      data: {\n        user_forgot_token: users.user_forgot_token,\n      },\n    });\n    await ext.sendVerifCode(users.user_email, users.user_forgot_token);\n    user.user = { role: \"guest\", user: { ...users } };\n    res = users !== null ? \"Success set token\" : \"Failed set token\";\n  }\n  if (e === \"UpdatePass\") {\n    users = await db.users.update({\n      where: {\n        user_id: users.user_id,\n      },\n      data: {\n        user_password: users.user_password,\n      },\n    });\n    user.user = { role: \"guest\", user: { ...users } };\n    res = users !== null ? \"Success set password\" : \"Failed set password\";\n  }\n  if (e === \"Logout\") {\n    user.user = { role: \"guest\" };\n    res = \"User Logout\";\n  }\n  // console.log(users);\n  reply.send({\n    res: res,\n    e,\n    users,\n  })\n}","figma":{}},"title":"crud-user","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"66283","slug":"/api/crud-user","site":"*","id":"20265"}