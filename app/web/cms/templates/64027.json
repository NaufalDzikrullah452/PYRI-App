{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  // input mocks:\n  // let user_id = 1;\n  // let tags_id = [4, 3, 1];\n  // let e = \"show\";\n\n  // real implementation:\n  let { user_id, tags_id, e } = req.body;\n\n  if (tags_id && tags_id.length > 3) {\n    reply.send({\n      res: \"Validation failed. Too many tags\",\n    });\n  } else {\n    if (e == \"index\") {\n      const tags = await db.tags.findMany({});\n\n      reply.send({\n        res: \"Success\",\n        result: tags,\n      });\n    }\n\n    if (e == \"post\") {\n      const recordExists = await db.interests.findFirst({\n        where: {\n          user_id: user_id,\n        },\n      });\n\n      if (recordExists) {\n        await db.interests.deleteMany({\n          where: {\n            user_id: user_id,\n          },\n        });\n      }\n\n      for (let index = 0; index < tags_id.length; index++) {\n        let interest = await db.interests.create({\n          data: {\n            user_id: user_id,\n            tag_id: parseInt(tags_id[index]),\n          },\n        });\n      }\n\n      reply.send({\n        res: \"Success\",\n        result: tags_id,\n      });\n    }\n\n    if (e == \"show\") {\n      const interests = await db.interests.findMany({\n        where: {\n          user_id: user_id,\n        },\n        include: {\n          tags: true,\n        },\n      });\n\n      reply.send({\n        res: \"Success\",\n        result: interests,\n      });\n    }\n  }\n}","figma":{}},"title":"api-interests","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"54643","slug":"/api/interests","site":"*","id":"64027"}