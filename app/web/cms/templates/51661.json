{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  try {\n    const data = await req.file({\n      limits: {\n        fileSize: 2000000, // 2MB\n      },\n    });\n\n    const path = !!data.fields.path ? data.fields.path.value : \"\";\n    const name = `${Date.now()}_${data.filename}`;\n    const dir = ext.path.join(__dirname, \"..\", \"..\", \"..\", \"uploads\", path);\n    const fullpath = `${dir}/${name}`;\n\n    if (!ext.fs.existsSync(dir)) {\n      ext.fs.mkdirSync(dir);\n    }\n\n    await ext.pump(data.file, ext.fs.createWriteStream(fullpath));\n    reply.send({\n      status: \"ok\",\n      path: ext.path.join(path, name).replace(/\\\\/gi, \"/\"),\n    });\n  } catch (e) {\n    reply.send({ status: \"failed\", reason: e.toString() });\n  }\n}","figma":{}},"title":"api-upload","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"66283","slug":"api/upload","site":"*","id":"51661"}