<>
  <effect
    meta={{
      tag_name: "",
      tag_picture: "",
      form_data: "",

      async onChange(key, e) {
        let value = e.target.value;
        runInAction(() => (this[key] = value));
        console.log(key + " : " + value);
      },

      validation() {
        let msg =
          this.tag_name === "" || this.tag_name === null
            ? "Name cant be empty!"
            : false;
        return msg;
      },

      async submit() {
        let error_msg = this.validation();

        if (error_msg) {
          alert(error_msg);
        } else {
          // const response = await fetch("/api/upload", {
          //   method: "POST",
          //   body: this.form_data,
          // });
          // let res = await response.json();
          // this.tag_picture = res.path;
          let tag = api("/api/tags", {
            tags: {
              tag_name: this.tag_name,
              tag_date_updated: new Date(),
              tag_picture: this.tag_picture,
            },
            e: "Create",
          }).then((res) => {
            console.log(res);
            navigate("/w-master-genre");
          });
        }
      },

      // async setFile(formData) {
      //   runInAction(() => {
      //     this.form_data = formData;
      //   })
      //   console.log(this.form_data);
      // },
      async upload(file) {
        const formData = _FormData();

        formData.append("path", "img");
        formData.append("file", file); // this.setFile(formData);

        const response = await fetch("/api/upload", {
          method: "POST",
          body: formData,
        });
        return await response.json();
      },
    }}
    run={async () => {
      if (window.user.roleAdmin !== "admin") {
        navigate("/login-admin");
      }
    }}
  />
  <div class={`w-full flex items-start justify-start bg-white`}>
    <div class={`w-full flex flex-1 self-stretch items-start justify-start`}>
      <w-sidebar
        class={`flex self-stretch flex-col space-y-20 items-center justify-start py-9 bg-gray-900`}
        style={"background-color: black"}
      />
      <div
        class={`w-full flex flex-1 self-stretch flex-col space-y-9 items-start justify-start bg-gray-100`}
      >
        <div class="flex self-stretch flex-col items-start justify-center py-9 bg-white">
          <div class="flex self-stretch flex-col items-start justify-start px-9">
            <div class="flex self-stretch space-x-2.5 items-center justify-start">
              <div class="flex flex-1 items-start justify-start">
                <div class="text-3xl font-bold leading-10">Genre Buku</div>
              </div>
              <div class="flex space-x-2.5 items-center justify-end px-4">
                <img
                  src="/fimgs/2169_108517.x1.png"
                  class="flex items-start justify-start p-2.5"
                  style="width: 60px; min-width: 60px; max-width: 60px; height: 60px; min-height: 60px; max-height: 60px;"
                />
                <div class="flex items-start justify-start">
                  <div class="text-base font-medium leading-normal text-gray-700">
                    Savannah Nguyen
                  </div>
                </div>
                <img
                  src="/fimgs/1909_13255.x1.svg"
                  style="width: 18.87px; min-width: 18.87px; max-width: 18.87px; height: 18.43px; min-height: 18.43px; max-height: 18.43px;"
                />
              </div>
            </div>
          </div>
        </div>
        <div
          class={`w-full flex self-stretch flex-col items-start justify-start px-9 rounded`}
        >
          <div class="flex self-stretch flex-col items-center justify-start p-6 bg-gray-900 rounded-tl-lg rounded-tr-lg">
            <div class="flex self-stretch items-start justify-start">
              <div class="flex flex-1 self-stretch items-center justify-start">
                <div class="text-base font-bold leading-normal text-white">
                  TAMBAH GENRE BUKU
                </div>
              </div>
            </div>
          </div>
          <div class="flex self-stretch flex-col space-y-6 items-start justify-start p-9 bg-white rounded-bl-lg rounded-br-lg">
            <div
              class={`flex flex-col space-y-3 items-start justify-start w-full`}
              style={`max-width:567px`}
            >
              <div
                class={`flex self-stretch flex-col space-y-3 items-start justify-start`}
                style={"margin-bottom: 15px;"}
              >
                <div class="flex items-start justify-start">
                  <div class="text-base font-bold leading-normal">Ikon</div>
                </div>
                <input
                  type={`file`}
                  class={`flex self-stretch flex-col space-y-2.5 items-center justify-center p-4 bg-white border rounded border-gray-400 dropify`}
                  style={`height: 210px; min-height: 210px; max-height: 210px;`}
                  onChange={(e) => {
                    runInAction(async () => {
                      const upload = await meta.upload(e.target.files[0]);
                      meta.tag_picture = upload.path;
                    });
                  }}
                />
              </div>
              <div class="flex items-start justify-start">
                <div class="text-base font-bold leading-normal">Nama Genre</div>
              </div>
              <div
                class="flex self-stretch items-start justify-start px-4 py-2 border rounded border-gray-400"
                style="height: 40px; min-height: 40px; max-height: 40px;"
              >
                <input
                  class={"w-full"}
                  type="text"
                  placeholder="Masukkan nama genre"
                  style={`color: black;
      background:transparent; 
      outline: none;`}
                  value={meta.tag_name}
                  onChange={(e) => {
                    meta.onChange("tag_name", e);
                  }}
                />
              </div>
              <div class="flex space-x-3 items-end justify-start pt-9">
                <button
                  class={`flex items-start justify-start px-4 py-2 bg-amber-500 rounded`}
                  onClick={meta.submit}
                >
                  <div class="text-base font-bold leading-normal text-white">
                    Tambah
                  </div>
                </button>
                <button
                  class={`flex items-start justify-start px-4 py-2 border rounded border-gray-400`}
                  onClick={() => {
                    navigate("/w-master-genre");
                  }}
                >
                  <div class="text-base font-bold leading-normal text-amber-500">
                    Batal
                  </div>
                </button>
              </div>
            </div>
            {meta.tag_picture !== "" &&
              typeof meta.tag_picture === "string" && (
                <img src={`/upload/${meta.tag_picture}`} />
              )}
          </div>
        </div>
      </div>
    </div>
  </div>
</>